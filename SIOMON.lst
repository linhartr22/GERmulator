0000                             ;*****
0000                             ;* Equates
0000                             ;*
0000                NUL:      EQU   $00   
0000                BEL:      EQU   $07   
0000                BS:       EQU   $08   
0000                HT:       EQU   $09   
0000                LF:       EQU   $0a   
0000                FF:       EQU   $0c   
0000                CR:       EQU   $0d   
0000                ESC:      EQU   $1b   
0000                SIODATA:   EQU   $80   
0000                SIOST:    EQU   $81   
0000                SIOSTTXRDY:   EQU   $01   
0000                SIOSTRXRDY:   EQU   $02   
0000                SIOSTTXE:   EQU   $04   
0000                SIOMO:    EQU   $81   
0000                SIOMOS1:   EQU   $40   
0000                SIOMOS15:   EQU   $80   
0000                SIOMOS2:   EQU   $c0   
0000                SIOMOPE:   EQU   $20   
0000                SIOMOPEN:   EQU   $10   
0000                SIOMOC5:   EQU   $00   
0000                SIOMOC6:   EQU   $04   
0000                SIOMOC7:   EQU   $08   
0000                SIOMOC8:   EQU   $0c   
0000                SIOMOBS:   EQU   $00   
0000                SIOMOB1X:   EQU   $01   
0000                SIOMOB16X:   EQU   $02   
0000                SIOMOB64X:   EQU   $03   
0000                SIOMOI:   EQU   siomos1+siomoc8+siomob16x   
0000                SIOCMD:   EQU   $81   
0000                SIOCMDTXEN:   EQU   $01   
0000                SIOCMDDTR:   EQU   $02   
0000                SIOCMDRXEN:   EQU   $04   
0000                SIOCMDER:   EQU   $10   
0000                SIOCMDRTS:   EQU   $20   
0000                SIOCMDIR:   EQU   $40   
0000                SIOCMDI:   EQU   siocmddtr+siocmdrts+siocmdtxen+siocmder   
0000                             ;*****
0000                             ;* Init
0000                             ;*
0100                          .ORG   $0100   
0100   31 00 FF     INIT:     LXI   sp,spinit   ; Init SP
0103   97           SIOINIT:   SUB   a   ; Clear SIO Init Sequence
0104   D3 81                  OUT   siomo   
0106   D3 81                  OUT   siomo   
0108   D3 81                  OUT   siomo   
010A   3E 40                  MVI   a,siocmdir   ; Send SIO Command Internal Reset
010C   D3 81                  OUT   siocmd   
010E   3E 4E                  MVI   a,siomoi   ; Send SIO Mode Instruction
0110   D3 81                  OUT   siomo   
0112   3E 33                  MVI   a,siocmdi   ; Send SIO Command Instruction
0114   D3 81                  OUT   siocmd   
0116   21 00 1E     MONINIT:   LXI   h,grtmsg   ; Display Greet Message
0119   CD 09 18               CALL   soutstr   
011C                             ;*****
011C                             ;* Main
011C                             ;*
011C   21 30 1E     MAIN:     LXI   h,clmsg   ; Display Prompt
011F   CD 09 18               CALL   soutstr   
0122   3E 37                  MVI   a,siocmdi+siocmdrxen   ; Set SIO RX Enable
0124   D3 81                  OUT   siocmd   
0126   21 00 80               LXI   h,clbuf   ; Get SIO Command Line Buffer Pointer
0129   01 0C 00               LXI   b,clbufe-clbuf   ; Get SIO Command Line Buffer Size (Zeros B - Size in C)
012C   CD 39 18               CALL   sinstr   ; Get SIO Command Line Buffer
012F   3E 33                  MVI   a,siocmdi   ; Clear SIO RX Enable
0131   D3 81                  OUT   siocmd   
0133   C3 1C 01               JMP   main   
0136                             ;*****
0136                             ;* Library
0136                             ;*
1800                          .ORG   $1800   
1800                             ;=====
1800                             ;= Serial Output Character in Acc
1800                             ;= Modifies: None
1800   F5           SOUTC:    PUSH   psw   ; Save Char
1801   DB 81                  IN   SIOST   ; Check if SIO Ready to Tx
1803   E6 04                  ANI   siosttxe   
1805   F1                     POP   psw   ; Restore Char
1806   D3 80                  OUT   siodata   ; Output Char to SID Data Port
1808   C9           SOUTCX:   RET      ; Done
1809                             ;=====
1809                             ;= Serial Output String at HL
1809                             ;= Modifies: AF, HL
1809   7E           SOUTSTR:   MOV   a,m   ; Get Char from Buffer
180A   B7                     ORA   a   ; Null?
180B   CA 15 18               JZ   soutstrx   ; Yes, Exit
180E   CD 00 18               CALL   soutc   ; No, Serial Output Char
1811   23                     INX   h   ; Inc Buffer Pointer
1812   C3 09 18               JMP   soutstr   ; Get Next Char
1815   C9           SOUTSTRX:   RET      ; End of String
1816                             ;=====
1816                             ;= Serial Output Hex Byte in Acc
1816                             ;= Modifies AF
1816   F5           SOUTHEXB:   PUSH   psw   ; Save Byte
1817   0F                     RRC      ; Get Upper Nibble
1818   0F                     RRC      
1819   0F                     RRC      
181A   0F                     RRC      
181B   E6 0F                  ANI   0fh   ; Mask off Upper Nibble
181D   C6 30                  ADI   '0'   ; Convert to ASCII
181F   FE 3A                  CPI   ':'   ; Hex Adjust?
1821   DA 26 18               JC   southexb1   ; No
1824   C6 07                  ADI   'A'-':'   ; Yes
1826   CD 00 18     SOUTHEXB1:   CALL   soutc   ; Serial Output Char
1829   F1                     POP   psw   ; Restore Char
182A   E6 0F                  ANI   0fh   ; Mask off Upper Nibble
182C   C6 30                  ADI   '0'   ; Convert to ASCII
182E   FE 3A                  CPI   ':'   ; Hex Adjust?
1830   DA 35 18               JC   southexb2   ; No
1833   C6 07                  ADI   'A'-':'   ; Yes
1835   C3 00 18     SOUTHEXB2:   JMP   soutc   ; Serial Output Char
1838   C9                     RET      ; Done
1839                             ;=====
1839                             ;= Serial Input String at HL
1839                             ;= Modifies AF, BC, DE, HL
1839   CD 60 18     SINSTR:   CALL   sinc   ; Get Character
183C   FE 0D                  CPI   cr   ; Carriage Return?
183E   CA 5E 18               JZ   sinstrx   ; Yes, Exit
1841   FE 08                  CPI   bs   ; Backspace?
1843   CA 57 18               JZ   sinstrbs   ; Yes, Backspace
1846   FE 20                  CPI   ' '   ; Printable Character?
1848   DA 39 18               JC   sinstr   ; No, Ignore Character
184B   57                     MOV   d,a   ; No, Save Character
184C   78                     MOV   a,b   ; Character Counter = Buffer Size?
184D   B9                     CMP   c   
184E   CA 39 18               JZ   sinstr   ; Yes, Ignore Character
1851   72                     MOV   m,d   ; No, Save Character in Buffer
1852   23                     INX   h   ; Inc Buffer Pointer
1853   04                     INR   b   ; Inc Buffer Count
1854   C3 39 18               JMP   sinstr   ; Get Next Character
1857   78           SINSTRBS:   MOV   a,b   ; Count = 0?
1858   B7                     ORA   a   
1859   CA 39 18               JZ   sinstr   ; Yes, Ignore Backspace
185C   2B                     DCX   h   ; Dec Buffer Pointer
185D   04                     INR   b   ; Inc Character Count
185E   36 00        SINSTRX:   MVI   m,nul   ; Null Terminate Buffer
1860                             ;=====
1860                             ;= Serian Input Character to Acc
1860                             ;= Modifies AF
1860   DB 81        SINC:     IN   siost   ; Character Ready?
1862   E6 01                  ANI   SIOSTTXRDY   
1864   C2 60 18               JNZ   sinc   ; No, Keep Waiting
1867   DB 80                  IN   siodata   ; Input Character
1869   E6 7F                  ANI   $7f   ; Make 7-bit ASCII
186B   C9                     RET      
186C                             ;*****
186C                             ;* String Constants
186C                             ;*
1E00                          .ORG   1e00H   
1E00   47 45 52 6D 6F 6E 20 76 31 2E 30 07 GRTMSG:   DB   'GERmon v1.0',bel   
1E0C   20 20 20 52 6F 67 65 72 20 44 2E 20 4C 69 6E 68 61 72 74 07 DB   '   Roger D. Linhart',bel   
1E20   20 20 20 4E 6F 76 20 32 30 31 38 07 0D 0A 0A 00 DB   '   Nov 2018',bel,cr,lf,lf,nul   
1E30   0D 0A 3F 20 00 CLMSG:   DB   cr,lf,'? ',nul   
1E35                             ;HLPMSG:
1E35                             ;            DB      'd bbbb eeee <enter>  Display Memory',cr,lf
1E35                             ;            DB      'e aaaa <enter>       Edit Memory',cr,lf
1E35                             ;            DB      'g aaaa <enter>       Execute (GoTo) Memory',cr,lf,nul
1E35                             ;*****
1E35                             ;* RAM
1E35                             ;*
8000                          .ORG   8000h   
8000                CLBUF:    DS   12   ; Command Line Buffer (String - Null Delimited)
800C                CLBUFE:   DS   1   
800D                             ;*****
800D                             ;* STACK
800D                             ;*
FE00                          .ORG   0fe00h   
FE00                          DS   100h   
FF00                SPINIT:   EQU   $   


NUL:                0000 DEFINED AT LINE 4
                    > USED AT LINE 153
BEL:                0007 DEFINED AT LINE 5
                    > USED AT LINE 170
                    > USED AT LINE 171
                    > USED AT LINE 172
BS:                 0008 DEFINED AT LINE 6
                    > USED AT LINE 136
HT:                 0009 DEFINED AT LINE 7
LF:                 000A DEFINED AT LINE 8
                    > USED AT LINE 173
FF:                 000C DEFINED AT LINE 9
CR:                 000D DEFINED AT LINE 10
                    > USED AT LINE 134
                    > USED AT LINE 173
ESC:                001B DEFINED AT LINE 11
SIODATA:            0080 DEFINED AT LINE 13
                    > USED AT LINE 93
                    > USED AT LINE 161
SIOST:              0081 DEFINED AT LINE 15
                    > USED AT LINE 90
                    > USED AT LINE 158
SIOSTTXRDY:         0001 DEFINED AT LINE 16
                    > USED AT LINE 159
SIOSTRXRDY:         0002 DEFINED AT LINE 17
SIOSTTXE:           0004 DEFINED AT LINE 18
                    > USED AT LINE 91
SIOMO:              0081 DEFINED AT LINE 20
                    > USED AT LINE 53
                    > USED AT LINE 54
                    > USED AT LINE 55
                    > USED AT LINE 59
SIOMOS1:            0040 DEFINED AT LINE 21
                    > USED AT LINE 34
SIOMOS15:           0080 DEFINED AT LINE 22
SIOMOS2:            00C0 DEFINED AT LINE 23
SIOMOPE:            0020 DEFINED AT LINE 24
SIOMOPEN:           0010 DEFINED AT LINE 25
SIOMOC5:            0000 DEFINED AT LINE 26
SIOMOC6:            0004 DEFINED AT LINE 27
SIOMOC7:            0008 DEFINED AT LINE 28
SIOMOC8:            000C DEFINED AT LINE 29
                    > USED AT LINE 34
SIOMOBS:            0000 DEFINED AT LINE 30
SIOMOB1X:           0001 DEFINED AT LINE 31
SIOMOB16X:          0002 DEFINED AT LINE 32
                    > USED AT LINE 34
SIOMOB64X:          0003 DEFINED AT LINE 33
SIOMOI:             004E DEFINED AT LINE 34
                    > USED AT LINE 58
SIOCMD:             0081 DEFINED AT LINE 36
                    > USED AT LINE 57
                    > USED AT LINE 61
                    > USED AT LINE 72
                    > USED AT LINE 77
SIOCMDTXEN:         0001 DEFINED AT LINE 37
                    > USED AT LINE 43
SIOCMDDTR:          0002 DEFINED AT LINE 38
                    > USED AT LINE 43
SIOCMDRXEN:         0004 DEFINED AT LINE 39
                    > USED AT LINE 71
SIOCMDER:           0010 DEFINED AT LINE 40
                    > USED AT LINE 43
SIOCMDRTS:          0020 DEFINED AT LINE 41
                    > USED AT LINE 43
SIOCMDIR:           0040 DEFINED AT LINE 42
                    > USED AT LINE 56
SIOCMDI:            0033 DEFINED AT LINE 43
                    > USED AT LINE 60
                    > USED AT LINE 71
                    > USED AT LINE 76
INIT:               0100 DEFINED AT LINE 50
SIOINIT:            0103 DEFINED AT LINE 52
MONINIT:            0116 DEFINED AT LINE 63
MAIN:               011C DEFINED AT LINE 69
                    > USED AT LINE 79
SOUTC:              1800 DEFINED AT LINE 89
                    > USED AT LINE 102
                    > USED AT LINE 120
                    > USED AT LINE 127
SOUTCX:             1808 DEFINED AT LINE 94
SOUTSTR:            1809 DEFINED AT LINE 99
                    > USED AT LINE 64
                    > USED AT LINE 70
                    > USED AT LINE 104
SOUTSTRX:           1815 DEFINED AT LINE 105
                    > USED AT LINE 101
SOUTHEXB:           1816 DEFINED AT LINE 110
SOUTHEXB1:          1826 DEFINED AT LINE 120
                    > USED AT LINE 118
SOUTHEXB2:          1835 DEFINED AT LINE 127
                    > USED AT LINE 125
SINSTR:             1839 DEFINED AT LINE 133
                    > USED AT LINE 75
                    > USED AT LINE 139
                    > USED AT LINE 143
                    > USED AT LINE 147
                    > USED AT LINE 150
SINSTRBS:           1857 DEFINED AT LINE 148
                    > USED AT LINE 137
SINSTRX:            185E DEFINED AT LINE 153
                    > USED AT LINE 135
SINC:               1860 DEFINED AT LINE 158
                    > USED AT LINE 133
                    > USED AT LINE 160
GRTMSG:             1E00 DEFINED AT LINE 170
                    > USED AT LINE 63
CLMSG:              1E30 DEFINED AT LINE 173
                    > USED AT LINE 69
CLBUF:              8000 DEFINED AT LINE 184
                    > USED AT LINE 73
                    > USED AT LINE 74
CLBUFE:             800C DEFINED AT LINE 185
                    > USED AT LINE 74
SPINIT:             FF00 DEFINED AT LINE 193
                    > USED AT LINE 50
